/*! @locomotivemtl/charcoal-contrib-tinify 23-07-2019 */

Charcoal.Admin.Widget_Form.prototype.init=function(){var e=this;this.guide=new Charcoal.Admin.Guide,this.guide.fetch(function(){e.hasHelpButton()&&(e.addButtons(),e.addEventListeners())})},Charcoal.Admin.Widget_Form.prototype.addButtons=function(){this.getSidebar().find("header").children("h2").append($('<a href="guide/video" class="badge badge-secondary float-right js-guide">?</a>'))},Charcoal.Admin.Widget_Form.prototype.addEventListeners=function(){var e=this;this.getSidebar().on("click",".js-guide",function(t){t.preventDefault(),e.guide.popVideo(e.obj_type)})},Charcoal.Admin.Widget_Form.prototype.hasHelpButton=function(){if(void 0!==this._hasHelpButton)return this._hasHelpButton;if(this._hasHelpButton=!1,this.getSidebar().length){var e=this.guide.data;if(void 0!==e[this.obj_type]&&void 0!==e[this.obj_type].form){var t=e[this.obj_type].form;e:for(var i in t)for(var o=t[i].ids,n=o.length,r=0;r<n;r++)if(o[r]===this.obj_id){this._hasHelpButton=!0;break e}}}return this._hasHelpButton},Charcoal.Admin.Widget_Form.prototype.getSidebar=function(){return void 0!==this.sidebar?this.sidebar:(this.sidebar=$(".js-sidebar-widget",this.form_selector),this.sidebar)},Charcoal.Admin.Guide=function(){this.url="guide/fetch/objects"},Charcoal.Admin.Guide.prototype.fetch=function(e){var t=this;fetch(this.url,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},referrer:"no-referrer"}).then(function(e){return e.json()}).then(function(i){t.data=i,"function"==typeof e&&e()})},Charcoal.Admin.Guide.prototype.popVideo=function(e){if(void 0===this.data[e])return console.error("No help video defined for object type: "+e),!1;var t='<figure class="embed-responsive embed-responsive-16by9">\n<iframe width="640" height="480" src="'+this.data[e].video+'">\n</iframe>\n</figure>';BootstrapDialog.show({nl2br:!1,message:t,buttons:[{label:"Ok",action:function(e){e.close()}}]})},Charcoal.Admin.Guide.Associate=function(e){this.template=e.html(),this.$el=e,this.$container=e.parents(".js-fieldset-container"),this.addEventListeners()},Charcoal.Admin.Guide.Associate.prototype.addEventListeners=function(){var e=this;this.$el.on("click.add",".js-add",function(t){t.preventDefault();var i=$('<fieldset class="js-fieldset-template">'+e.template+"</fieldset>");e.$container.append(i),new Charcoal.Admin.Guide.Associate(i),e.$el.off("click.add"),$(t.currentTarget).addClass("d-none"),$(t.currentTarget).siblings(".js-remove").removeClass("d-none")}),this.$el.on("click.remove",".js-remove",function(t){$(t.currentTarget).addClass("d-none"),$(t.currentTarget).siblings(".js-add").removeClass("d-none"),e.$el.off("click"),e.$el.remove()})},Charcoal.Admin.Widget_Table.prototype.init=function(){this.set_properties().bind_events()};
/*! @locomotivemtl/charcoal-contrib-tinify 26-07-2019 */

Charcoal.Admin.Widget_Form.prototype.init=function(){var e=this;this.guide=new Charcoal.Admin.Guide,this.guide.fetch(function(){e.hasHelpButton()&&(e.addButtons(),e.addEventListeners())},{obj_type:this.obj_type})},Charcoal.Admin.Widget_Form.prototype.addButtons=function(){this.getSidebar().find("header").children("h2").append($('<a href="guide/video" class="badge badge-secondary float-right js-guide">?</a>'))},Charcoal.Admin.Widget_Form.prototype.addEventListeners=function(){var e=this;this.getSidebar().on("click",".js-guide",function(t){t.preventDefault(),e.guide.popVideo(e.obj_type)})},Charcoal.Admin.Widget_Form.prototype.hasHelpButton=function(){if(void 0!==this._hasHelpButton)return this._hasHelpButton;if(this._hasHelpButton=!1,this.getSidebar().length){var e=this.guide.data;if(void 0!==e[this.obj_type]&&void 0!==e[this.obj_type].form){var t=e[this.obj_type].form;e:for(var i in t)for(var o=t[i].ids,n=o.length,a=0;a<n;a++)if(o[a].toString()===this.obj_id.toString()){this.guide.setVideo(t[i].video),this._hasHelpButton=!0;break e}}}return this._hasHelpButton},Charcoal.Admin.Widget_Form.prototype.getSidebar=function(){return void 0!==this.sidebar?this.sidebar:(this.sidebar=$(".js-sidebar-widget",this.form_selector),this.sidebar)},Charcoal.Admin.Guide=function(){this.video={},this.url="guide/fetch/objects"},Charcoal.Admin.Guide.prototype.fetch=function(e,t){var i=this;fetch(this.url+"?obj_type="+t.obj_type,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},referrer:"no-referrer"}).then(function(e){return e.json()}).then(function(t){i.data=t,"function"==typeof e&&e()})},Charcoal.Admin.Guide.prototype.setVideo=function(e){return this.video=e,this},Charcoal.Admin.Guide.prototype.popVideo=function(e){if(void 0===this.data[e])return console.error("No help video defined for object type: "+e),!1;var t=this.video;if(void 0===t.id)return console.error("No video defined for the current object"),this;var i='<figure class="embed-responsive embed-responsive-16by9">\n<iframe width="640" height="480" src="https://www.youtube.com/embed/'+t.id+'">\n</iframe>\n</figure><br><a href="https://www.youtube.com/watch?v='+t.id+'" target="_blank">View on youtube</a>';BootstrapDialog.show({nl2br:!1,message:i,buttons:[{label:"Ok",action:function(e){e.close()}}]})},Charcoal.Admin.Guide.Associate=function(e){this.template=e.html(),this.$el=e,this.$container=e.parents(".js-fieldset-container"),this.addEventListeners()},Charcoal.Admin.Guide.Associate.prototype.addEventListeners=function(){var e=this;this.$el.on("click.add",".js-add",function(t){t.preventDefault();var i=$('<fieldset class="js-fieldset-template">'+e.template+"</fieldset>");e.$container.append(i),new Charcoal.Admin.Guide.Associate(i),e.$el.off("click.add"),$(t.currentTarget).addClass("d-none"),$(t.currentTarget).siblings(".js-remove").removeClass("d-none")}),this.$el.on("click.remove",".js-remove",function(t){$(t.currentTarget).addClass("d-none"),$(t.currentTarget).siblings(".js-add").removeClass("d-none"),e.$el.off("click"),e.$el.remove()})},Charcoal.Admin.Widget_Table.prototype.init=function(){this.set_properties().bind_events();var e=this;this.guide=new Charcoal.Admin.Guide,this.guide.fetch(function(){e.hasHelpButton()&&(e.addButtons(),e.addEventListeners())},{obj_type:this.obj_type})},Charcoal.Admin.Widget_Table.prototype.addButtons=function(){this.getTable().append($('<a href="guide/video" class="badge badge-secondary float-right js-guide">?</a>').css("font-size","14px"))},Charcoal.Admin.Widget_Table.prototype.addEventListeners=function(){var e=this;this.getTable().on("click",".js-guide",function(t){t.preventDefault(),e.guide.popVideo(e.obj_type)})},Charcoal.Admin.Widget_Table.prototype.hasHelpButton=function(){if(void 0!==this._hasHelpButton)return this._hasHelpButton;this._hasHelpButton=!1;var e=this.guide.data;if(void 0!==e[this.obj_type]&&void 0!==e[this.obj_type].table){var t=e[this.obj_type].table;for(var i in t){var o=t[i].video;this.guide.setVideo(o),this._hasHelpButton=!0;break}}return this._hasHelpButton},Charcoal.Admin.Widget_Table.prototype.getTable=function(){return void 0!==this.table?this.table:(this.table=this._element.find(".c-table-container").find(".c-table-pagination"),this.table)};